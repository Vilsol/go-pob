import{c as _t,a as j,t as re}from"../chunks/disclose-version.boCT8-mN.js";import{L as kt,M as bt,N as ht,p as wt,a as _,g as t,O as b,h as W,b as Ze,e as Dt,s as D,i as c,c as s,r,H as yt,j as et,k as tt}from"../chunks/runtime.LiVz1aeE.js";import{s as xt}from"../chunks/render.CHZTRx_f.js";import{i as lt}from"../chunks/this.BOTMusHW.js";import{e as at,i as it}from"../chunks/each.DvyGQds8.js";import{r as se}from"../chunks/attributes.BN4LPk7_.js";import{d as gt,a as T}from"../chunks/props.CgGGVFgu.js";import{a as oe}from"../chunks/input.rdP5Bo0j.js";import{G as Pt,b as Me}from"../chunks/cache.BSfGHtbM.js";import{s as Lt,c as ne,b as we,a as It,i as Ge}from"../chunks/store.Bh8AggrJ.js";import{N as _e}from"../chunks/NumberInput.Dg48jHiX.js";import{I as Et}from"../chunks/Input.BBkKWE8p.js";import{s as Ct,l as m,c as A,U as Tt}from"../chunks/global.DtJTI8bA.js";import{w as Qe}from"../chunks/index.B8tINEtp.js";import{S as At,a as Nt,b as Mt}from"../chunks/SelectSelection.DyKbjltK.js";import{o as Qt}from"../chunks/index-client.wZdNs1fV.js";import{c as De}from"../chunks/colors.DCgE6yJT.js";function Bt(o,h=!1){return ye(o,new Map)}function ye(o,h,y,a){if(typeof o=="object"&&o!==null){const ce=h.get(o);if(ce!==void 0)return ce;if(o instanceof Map)return new Map(o);if(o instanceof Set)return new Set(o);if(kt(o)){const P=[];h.set(o,P);for(let H=0;H<o.length;H+=1)P.push(ye(o[H],h));return P}if(bt(o)===ht){const P={};h.set(o,P);for(var S in o)P[S]=ye(o[S],h);return P}if(o instanceof Date)return structuredClone(o);if(typeof o.toJSON=="function")return ye(o.toJSON(),h)}if(o instanceof EventTarget)return o;try{return structuredClone(o)}catch{return o}}const Be=o=>o;var Ft=re("<option> </option>"),$t=re('<div slot="selection"><!></div>'),Ot=re('<div slot="item"><!></div>'),Rt=re('<button class="container font-bold">X</button> <div class="min-w-full themed"><!></div> <!> <div class="container select-wrapper"><select class="input"><option>Default</option></select></div> <!> <input type="checkbox" class="text-2xl"> <!>',1),Vt=(o,h)=>h(),jt=re('<div class="flex flex-col min-w-[30em] gap-2"><!> <div class="flex flex-row w-full justify-between"><div class="flex flex-row items-center gap-2"><span>Socketed in:</span> <div class="container select-wrapper"><select class="input"><option>None</option></select></div></div> <div class="flex flex-row items-center gap-2"><span>Enabled:</span> <input type="checkbox" class="text-2xl"></div> <div class="flex flex-row items-center gap-2"><span>Include in Full DPS:</span> <input type="checkbox" class="text-2xl"></div></div> <div class="grid gem-grid gap-1 w-full svelte-10n7688"><div></div> <div>Gem Name</div> <div>Level</div> <div>Variant</div> <div>Quality</div> <div>Enabled</div> <div>Count</div> <!> <div class="col-span-7 w-full mt-2"><button class="container font-bold min-w-full">Add Skill Gem</button></div></div></div>'),Wt=re('<div class="p-2 px-4 w-full h-full overflow-y-auto"><div class="flex flex-row gap-4 max-xl:flex-wrap"><div class="flex flex-col min-w-[24em] gap-2"><div class="flex flex-row items-center gap-2"><span>Skill set:</span> <div class="container select-wrapper flex-1"><select class="input"><option>Default</option></select></div> <button class="container">Manage...</button></div> <div class="flex flex-row items-center gap-2"><span class="flex-1">Socket Groups:</span> <button class="container">New</button> <button class="container">Delete All</button> <button class="container">Delete</button></div> <select class="bg-black border w-full border-neutral-400 flex-1 select-many max-h-[19em]" size="18"></select> <p class="text-sm">Usage Tips:<br> - You can copy/paste socket groups using Ctrl+C and Ctrl+V.<br> - Ctrl + Click to enable/disable socket groups.<br> - Ctrl + Right click to include/exclude in FullDPS calculations.<br> - Right click to set as the Main skill group.<br></p> <fieldset class="border border-white bg-neutral-900 p-2"><legend class="container">Gem Options</legend> <div class="side-by-side-max-content"><span>Sort gems by DPS:</span> <div class="flex flex-row gap-2"><input type="checkbox" class="text-2xl"> <div class="container select-wrapper"><select class="input"><option>Full DPS</option><option>Combined DPS</option><option>Total DPS</option><option>Average Hit</option><option>DoT DPS</option><option>Bleed DPS</option><option>Ignite DPS</option><option>Poison DPS</option></select></div></div> <span>Match gems character level:</span> <div class="flex flex-row gap-2"><input type="checkbox" class="text-2xl"></div> <span>Default gem level:</span> <!> <span>Default gem quality:</span> <!> <span>Show support gems:</span> <div class="flex flex-row gap-2"><div class="container select-wrapper"><select class="input"><option>All</option><option>Non-Awakened</option><option>Awakened</option></select></div></div> <span>Show gem quality variants:</span> <div class="flex flex-row gap-2"><input type="checkbox" class="text-2xl"></div></div></fieldset></div> <!></div></div>');function rl(o,h){wt(h,!0);const y=Lt(),a=()=>we(A,"$currentBuild",y),S=()=>we(N,"$currentGemGroup",y),ce=()=>we(ue,"$mainSocketGroup",y),P=()=>we(ke,"$socketGroupLabel",y);let H=W(1);_(()=>{var e,l,i;(i=(l=(e=a())==null?void 0:e.Skills)==null?void 0:l.SkillSets)==null||i.then(u=>D(H,T((u==null?void 0:u.length)||0))).catch(m)});let d=W(1);_(()=>{var e,l,i;(i=(l=(e=a())==null?void 0:e.Skills)==null?void 0:l.ActiveSkillSet)==null||i.then(u=>D(d,T(u))).catch(m)});let G=W(0);const ue=Qe(-1);_(()=>{var e,l,i;(i=(l=(e=a())==null?void 0:e.Build)==null?void 0:l.MainSocketGroup)==null||i.then(u=>ue.set(u-1)).catch(m)}),ue.subscribe(e=>{var l;e>=0&&((l=Ct)==null||l.SetMainSocketGroup(e+1).catch(m)),A.set(a())});let xe=W(!0);const ke=Qe("");_(()=>{var e,l,i,u,f;(f=(u=(i=(l=(e=a())==null?void 0:e.Skills)==null?void 0:l.SkillSets)==null?void 0:i[t(d)-1].Skills)==null?void 0:u[t(G)])==null||f.Label.then(L=>{D(xe,!0),ke.set(L),D(xe,!1)}).catch(m)}),ke.subscribe(e=>{t(xe)||!a()||ne(A,b(a).Skills.SkillSets[t(d)-1].Skills[t(G)].Label=e,b(a))});const st=(e,l)=>{l.preventDefault(),l.stopPropagation(),ue.set(e)};let pe=W(T([]));const Fe=T({}),ot={STR:De.STRENGTH,DEX:De.DEXTERITY,INT:De.INTELLIGENCE,NONE:De.NORMAL};Qt(()=>{Pt().then(e=>{D(pe,T(e.map(l=>({label:"^"+ot[l.GemType]+l.Base.Name,value:l.ID,data:l})))),e.forEach(l=>{Fe[l.ID]=l})}).catch(m)});let ge=W(!0);const N=Qe();_(()=>{t(pe).length<=0||new Promise(async()=>{var i,u,f,L,B;const e=(B=(L=(f=(u=(i=a())==null?void 0:i.Skills)==null?void 0:u.SkillSets)==null?void 0:f[t(d)-1])==null?void 0:L.Skills)==null?void 0:B[t(G)];if(!e){N.set(void 0);return}const l=[];if(e.Gems&&await e.Gems){const M=await e.Gems.length;for(let I=0;I<M;(I+=1)-1){const p=e.Gems[I],Q=await p.GemID;l.push({GemListValue:t(pe).find(E=>E.value===Q),GemID:Q,Quality:await p.Quality,Enabled:await p.Enabled,EnableGlobal1:await p.EnableGlobal1,EnableGlobal2:await p.EnableGlobal2,QualityID:await p.QualityID,Count:await p.Count,Level:await p.Level,SkillPart:await p.SkillPart,SkillPartCalcs:await p.SkillPartCalcs,NameSpec:await p.NameSpec,SkillID:await p.SkillID,SkillMinionItemSet:await p.SkillMinionItemSet,SkillMinion:await p.SkillMinion})}}D(ge,!0),N.set({Gems:l,Enabled:await e.Enabled,IncludeInFullDPS:await e.IncludeInFullDPS,Slot:await e.Slot}),D(ge,!1)}).catch(m)});let $e="";N.subscribe(async e=>{var i,u;if(t(ge)||!e||!a()||!await a().Skills||!await a().Skills.SkillSets||!await a().Skills.SkillSets[t(d)-1]||!await a().Skills.SkillSets[t(d)-1].Skills||!await a().Skills.SkillSets[t(d)-1].Skills[t(G)])return;const l=JSON.stringify(e);$e!==l&&($e=l,ne(A,b(a).Skills.SkillSets[t(d)-1].Skills[t(G)].Slot=Be(e.Slot),b(a)),ne(A,b(a).Skills.SkillSets[t(d)-1].Skills[t(G)].Enabled=Be(e.Enabled),b(a)),ne(A,b(a).Skills.SkillSets[t(d)-1].Skills[t(G)].IncludeInFullDPS=Be(e.IncludeInFullDPS),b(a)),e.Gems&&await((u=(i=a())==null?void 0:i.SetSocketGroupGems)==null?void 0:u.call(i,t(d)-1,t(G),Bt(e.Gems.map(f=>({...f,GemID:f.GemListValue.value}))))),Tt("currentGemGroup"))});let be=W(T([]));_(()=>{var e,l,i,u,f;(f=(u=(i=(l=(e=a())==null?void 0:e.Skills)==null?void 0:l.SkillSets)==null?void 0:i[t(d)-1])==null?void 0:u.Skills)==null||f.then(async L=>{var M,I,p,Q,E,ve,de,J,U,me,X,q,K,Y,z,Z,ee,te,Se,le;const B=[];for(let C=0;C<L.length;(C+=1)-1){let x=await((E=(Q=(p=(I=(M=a())==null?void 0:M.Skills)==null?void 0:I.SkillSets)==null?void 0:p[t(d)-1])==null?void 0:Q.Skills)==null?void 0:E[C].Label);if(x===""){const ae=(me=(U=(J=(de=(ve=a())==null?void 0:ve.Skills)==null?void 0:de.SkillSets)==null?void 0:J[t(d)-1])==null?void 0:U.Skills)==null?void 0:me[C].Gems;if(await ae)for(let F=0;F<await ae.length;(F+=1)-1){const ie=Fe[await ae[F].GemID];!ie||ie.Support||(x!==""&&(x+=", "),x+=ie.Base.Name)}else x="<No active skills>"}x&&B.push({label:x,enabled:await((z=(Y=(K=(q=(X=a())==null?void 0:X.Skills)==null?void 0:q.SkillSets)==null?void 0:K[t(d)-1])==null?void 0:Y.Skills)==null?void 0:z[C].Enabled),fullDPS:await((le=(Se=(te=(ee=(Z=a())==null?void 0:Z.Skills)==null?void 0:ee.SkillSets)==null?void 0:te[t(d)-1])==null?void 0:Se.Skills)==null?void 0:le[C].IncludeInFullDPS)||!1})}D(be,T(B))}).catch(m)});const nt=e=>{var l,i;(i=(l=S())==null?void 0:l.Gems)==null||i.splice(e,1),N.set(S())},rt=()=>{var l,i;const e=t(pe)[0];(i=(l=S())==null?void 0:l.Gems)==null||i.push({GemListValue:e,Quality:0,SkillPart:1,EnableGlobal2:!0,SkillPartCalcs:1,QualityID:"Default",GemID:"Metadata/Items/Gems/SkillGemFireball",Enabled:!0,Count:1,EnableGlobal1:!0,NameSpec:e.value,Level:1,SkillID:e.value,SkillMinionItemSet:1,SkillMinion:"SummonedPhantasm"}),N.set(S())},n=T({sortGemsByDPS:!0,sortGemsByDPSField:"FullDPS",matchGemLevelToCharacterLevel:!1,defaultGemLevel:20,defaultGemQuality:0,showSupportGemTypes:"ALL",showAltQualityGems:!1});_(()=>{var e;(e=a())==null||e.SetSortGemsByDPS(n.sortGemsByDPS).catch(m)}),_(()=>{var e;(e=a())==null||e.SetSortGemsByDPSField(n.sortGemsByDPSField).catch(m)}),_(()=>{var e;(e=a())==null||e.SetMatchGemLevelToCharacterLevel(n.matchGemLevelToCharacterLevel).catch(m)}),_(()=>{var e;(e=a())==null||e.SetDefaultGemLevel(n.defaultGemLevel).catch(m)}),_(()=>{var e;(e=a())==null||e.SetDefaultGemQuality(n.defaultGemQuality).catch(m)}),_(()=>{var e;(e=a())==null||e.SetShowSupportGemTypes(n.showSupportGemTypes).catch(m)}),_(()=>{var e;(e=a())==null||e.SetShowAltQualityGems(n.showAltQualityGems).catch(m)}),_(()=>{var e,l;(l=(e=a())==null?void 0:e.Skills)==null||l.then(i=>{n.sortGemsByDPS=i.SortGemsByDPS,n.sortGemsByDPSField=i.SortGemsByDPSField,n.matchGemLevelToCharacterLevel=i.MatchGemLevelToCharacterLevel,n.defaultGemLevel=parseInt(i.DefaultGemLevel||n.defaultGemLevel.toString()),n.defaultGemQuality=i.DefaultGemQuality||n.defaultGemQuality,n.showSupportGemTypes=i.ShowSupportGemTypes,n.showAltQualityGems=i.ShowAltQualityGems}).catch(m)});const ct=async()=>{var e;await((e=a())==null?void 0:e.AddNewSocketGroup()),A.set(a())},ut=async()=>{var e;await((e=a())==null?void 0:e.DeleteSocketGroup(t(G))),D(G,0),A.set(a())},pt=async()=>{var e,l;await((e=a())==null?void 0:e.DeleteAllSocketGroups()),await((l=a())==null?void 0:l.AddNewSocketGroup()),D(G,0),ue.set(0),A.set(a())};var Oe=_t(),vt=Ze(Oe);lt(vt,a,e=>{var l=Wt(),i=c(l),u=c(i),f=c(u),L=s(c(f),2),B=c(L);r(L),yt(2),r(f);var M=s(f,2),I=s(c(M),2);I.__click=ct;var p=s(I,2);p.__click=pt;var Q=s(p,2);Q.__click=ut,r(M);var E=s(M,2);at(E,21,()=>t(be),it,(v,$,O)=>{var g=Ft();g.value=(g.__value=O)==null?"":O,g.__contextmenu=he=>st(O,he);var fe=c(g);r(g),et(()=>xt(fe,`${t($).label??""}
              ${(t($).enabled?"":" (Disabled)")??""}
              ${(ce()===O?" (Active)":"")??""}
              ${(t($).fullDPS?" (FullDPS)":"")??""}`)),j(v,g)}),r(E);var ve=s(E,4),de=s(c(ve),2),J=s(c(de),2),U=c(J);se(U);var me=s(U,2),X=c(me),q=c(X);q.value=(q.__value="FullDPS")==null?"":"FullDPS";var K=s(q);K.value=(K.__value="CombinedDPS")==null?"":"CombinedDPS";var Y=s(K);Y.value=(Y.__value="TotalDPS")==null?"":"TotalDPS";var z=s(Y);z.value=(z.__value="AverageDamage")==null?"":"AverageDamage";var Z=s(z);Z.value=(Z.__value="TotalDot")==null?"":"TotalDot";var ee=s(Z);ee.value=(ee.__value="BleedDPS")==null?"":"BleedDPS";var te=s(ee);te.value=(te.__value="IgniteDPS")==null?"":"IgniteDPS";var Se=s(te);Se.value=(Se.__value="TotalPoisonDPS")==null?"":"TotalPoisonDPS",r(X),r(me),r(J);var le=s(J,4),C=c(le);se(C),r(le);var x=s(le,4);_e(x,{min:1,max:40,get value(){return n.defaultGemLevel},set value(v){n.defaultGemLevel=v}});var ae=s(x,4);_e(ae,{min:0,max:30,get value(){return n.defaultGemQuality},set value(v){n.defaultGemQuality=v}});var F=s(ae,4),ie=c(F),Pe=c(ie),Le=c(Pe);Le.value=(Le.__value="ALL")==null?"":"ALL";var Ie=s(Le);Ie.value=(Ie.__value="NORMAL")==null?"":"NORMAL";var Re=s(Ie);Re.value=(Re.__value="AWAKENED")==null?"":"AWAKENED",r(Pe),r(ie),r(F);var Ve=s(F,4),je=c(Ve);se(je),r(Ve),r(de),r(ve),r(u);var dt=s(u,2);lt(dt,S,v=>{var $=jt(),O=c($);Et(O,{prefix:"Label:",fullWidth:!0,get value(){return P()},set value(R){It(ke,T(R))}});var g=s(O,2),fe=s(c(g),2),he=s(c(fe),2);se(he),r(fe);var We=s(fe,2),He=s(c(We),2);se(He),r(We),r(g);var Je=s(g,2),Ue=s(c(Je),14);at(Ue,1,()=>S().Gems,it,(R,w,St)=>{var qe=Rt(),Ke=Ze(qe);Ke.__click=()=>nt(St);var Ee=s(Ke,2),ft=c(Ee);At(ft,{get value(){return t(w).GemListValue},set value(k){t(w).GemListValue=k,Ge(y,"$currentGemGroup")},get items(){return t(pe)},clearable:!1,placeholder:"",showChevron:!0,listOffset:0,$$slots:{selection:(k,Te)=>{var V=$t();const Ae=tt(()=>Te.selection);var Ne=c(V);Nt(Ne,{get item(){return t(Ae)}}),r(V),j(k,V)},item:(k,Te)=>{var V=Ot();const Ae=tt(()=>Te.item);var Ne=c(V);Mt(Ne,{get item(){return t(Ae)}}),r(V),j(k,V)}}}),r(Ee);var Ye=s(Ee,2);_e(Ye,{min:1,get max(){return t(w).GemListValue.data.MaxLevel},get value(){return t(w).Level},set value(k){t(w).Level=k,Ge(y,"$currentGemGroup")}});var ze=s(Ye,4);_e(ze,{min:0,max:30,get value(){return t(w).Quality},set value(k){t(w).Quality=k,Ge(y,"$currentGemGroup")}});var Ce=s(ze,2);se(Ce);var Gt=s(Ce,2);_e(Gt,{min:1,max:99,get value(){return t(w).Count},set value(k){t(w).Count=k,Ge(y,"$currentGemGroup")}}),oe(Ce,()=>t(w).Enabled,k=>(t(w).Enabled=k,Ge(y,"$currentGemGroup"))),j(R,qe)});var Xe=s(Ue,2),mt=c(Xe);mt.__click=[Vt,rt],r(Xe),r(Je),r($),oe(he,()=>S().Enabled,R=>ne(N,b(S).Enabled=R,b(S))),oe(He,()=>S().IncludeInFullDPS,R=>ne(N,b(S).IncludeInFullDPS=R,b(S))),j(v,$)}),r(i),r(l),et(()=>{B.disabled=t(H)===1,p.disabled=t(be).length<=1,Q.disabled=t(G)<0||t(be).length<=1}),Me(E,()=>t(G),v=>D(G,v)),oe(U,()=>n.sortGemsByDPS,v=>n.sortGemsByDPS=v),Me(X,()=>n.sortGemsByDPSField,v=>n.sortGemsByDPSField=v),oe(C,()=>n.matchGemLevelToCharacterLevel,v=>n.matchGemLevelToCharacterLevel=v),Me(Pe,()=>n.showSupportGemTypes,v=>n.showSupportGemTypes=v),oe(je,()=>n.showAltQualityGems,v=>n.showAltQualityGems=v),j(e,l)}),j(o,Oe),Dt()}gt(["click","contextmenu"]);export{rl as component};
